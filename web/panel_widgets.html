<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ guild_name }} - Widgets</title>
    <meta name="csrf-token" content="{{ csrf_token }}">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" type="image/png" href="/static/icon.png">
    <style>
        .url-box { display: flex; }
        .url-box input { width: 100%; font-family: 'Raleway', sans-serif; }
        .url-box button { width: auto; }
        .copy-status { margin-top: 8px; font-size: 14px; color: #57F287; visibility: hidden; height: 16px; text-align: left;}
    </style>
    <script>
        (function() {
            const body = document.body;
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme === 'light') {
                body.classList.add('light-mode');
            }
        })();
    </script>
</head>
<body class="body-fade-in">
    <header class="top-bar">
        <div class="logo">
            <img src="/static/logo.png" alt="Logo" class="logo-light-mode">
            <img src="/static/logo-white.png" alt="Logo" class="logo-dark-mode">
        </div>
        <div class="user-profile">
            <img src="{{ user_avatar_url }}" alt="User Avatar">
            <span>{{ user_name }}</span>
            <span class="access-badge">{{ access_level }} Access</span>

            <button id="theme-toggle-btn" class="icon-button">‚òÄÔ∏è</button>

            <a href="{{ url_for('logout', guild_id=guild_id) }}" class="icon-button logout-button" aria-label="Logout">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22px" height="22px">
                    <path fill-rule="evenodd" d="M7.5 3.75A1.5 1.5 0 006 5.25v13.5A1.5 1.5 0 007.5 20.25h3.75a.75.75 0 000-1.5H7.5a.75.75 0 010-1.5h3.75a.75.75 0 000-1.5H7.5a.75.75 0 010-1.5h3.75a.75.75 0 000-1.5H7.5a.75.75 0 010-1.5h3.75a.75.75 0 000-1.5H7.5a.75.75 0 010-1.5h3.75a.75.75 0 000-1.5H7.5A1.5 1.5 0 006 5.25z" clip-rule="evenodd" />
                    <path d="M13.06 8.22a.75.75 0 011.06 0l3.75 3.75a.75.75 0 010 1.06l-3.75 3.75a.75.75 0 11-1.06-1.06l2.47-2.47H9.75a.75.75 0 010-1.5h5.78l-2.47-2.47a.75.75 0 010-1.06z" />
                </svg>
            </a>
        </div>
    </header>

    <main class="main-content">
        <h2>Stream Widgets</h2>
        
        <div class="card">
            <h3>Setup Guide</h3>
            <p style="text-align: center;">
                Use the URLs below to add real-time submission widgets to your stream via a "Browser Source" in OBS, Streamlabs, or other streaming software.
                <br><strong>Do not share these links with anyone!</strong> They are unique to this server and grant access to live data.
            </p>
        </div>

        <div class="card" style="margin-top: 1.5rem; text-align: left;">
            <h4 style="margin-top: 0;">üéµ Regular Submissions Widget</h4>
            <div class="url-box">
                <input type="text" class="input" value="{{ regular_widget_url }}" id="regularUrl" readonly>
                <button class="button" onclick="copyToClipboard('regularUrl', 'regular-status')" aria-label="Copy URL" style="padding: 12px 15px;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20px" height="20px">
                        <path d="M7.5 3.75A2.25 2.25 0 005.25 6v13.5A2.25 2.25 0 007.5 21.75h9A2.25 2.25 0 0018.75 19.5V6A2.25 2.25 0 0016.5 3.75h-9zm6.75 2.25a.75.75 0 000-1.5h-4.5a.75.75 0 000 1.5h4.5zM7.5 7.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 017.5 7.5zm.75 2.25a.75.75 0 000 1.5h7.5a.75.75 0 000-1.5h-7.5z" />
                    </svg>
                </button>
            </div>
            <p class="copy-status" id="regular-status">Copied!</p>
        </div>
    </main>

    <nav class="bottom-bar">
        <a href="{{ url_for('panel_home', guild_id=guild_id) }}">Dashboard</a>
        <a href="{{ url_for('panel_widgets', guild_id=guild_id) }}" class="active">Widgets</a>
        <a href="{{ url_for('panel_mod_menu', guild_id=guild_id) }}">Mod Menu</a>
    </nav>

    <script>
        const themeToggleBtn = document.getElementById('theme-toggle-btn');
        const body = document.body;
        const currentTheme = localStorage.getItem('theme');

        if (currentTheme === 'light') {
            body.classList.add('light-mode');
            themeToggleBtn.textContent = 'üåô';
        } else {
            body.classList.remove('light-mode');
            themeToggleBtn.textContent = '‚òÄÔ∏è';
        }

        themeToggleBtn.addEventListener('click', () => {
            body.classList.toggle('light-mode');
            
            if (body.classList.contains('light-mode')) {
                themeToggleBtn.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                themeToggleBtn.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
        });
       
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.bottom-bar a, .top-bar a.logout-button');

            navLinks.forEach(link => {
                link.addEventListener('click', e => {
                    const href = link.getAttribute('href');

                    if (href && href.startsWith('/') && !e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        
                        document.body.classList.add('body-fade-out');

                        setTimeout(() => {
                            window.location.href = href;
                        }, 300);
                    }
                });
            });
        });        
        
        function copyToClipboard(inputId, statusId) {
            document.querySelectorAll('.copy-status').forEach(el => el.style.visibility = 'hidden');
            const urlInput = document.getElementById(inputId);
            urlInput.select();
            urlInput.setSelectionRange(0, 99999);
            document.execCommand('copy');
            const status = document.getElementById(statusId);
            status.style.visibility = 'visible';
            setTimeout(() => {
                status.style.visibility = 'hidden';
            }, 2000);
        }
    </script>
</body>
</html>